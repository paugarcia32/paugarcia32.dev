---
import type { CollectionEntry } from "astro:content";
import { slugifyTag } from "@lib/utils";

type Props = {
  entry: CollectionEntry<"blog"> | CollectionEntry<"projects">;
};

const { entry } = Astro.props;
---

<a href={`/${entry.collection}/${entry.slug}`} class="arrow-card relative group flex flex-nowrap py-3 px-4 pr-10 rounded-lg border border-black/15 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/5 hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out">
  <div class="flex flex-col flex-1 min-w-0">
    <div class="font-semibold truncate">
      {entry.data.title}
    </div>
    <div class="text-sm text-black/60 dark:text-white/60 truncate">
      {entry.data.description}
    </div>
    {entry.data.tags && entry.data.tags.length > 0 && (
      <div class="flex flex-wrap gap-1.5 mt-2">
        {entry.data.tags.map((tag) => (
          <span
            data-tag-url={`/tags/${slugifyTag(tag)}`}
            class="tag-badge inline-flex items-center rounded-full border border-black/10 bg-black/5 px-2 py-0.5 text-xs text-black/70 transition-colors duration-200 hover:border-black/20 hover:bg-black/10 hover:text-black cursor-pointer dark:border-white/10 dark:bg-white/5 dark:text-white/70 dark:hover:border-white/20 dark:hover:bg-white/10 dark:hover:text-white"
          >
            {tag}
          </span>
        ))}
      </div>
    )}
  </div>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    class="absolute top-1/2 right-2 -translate-y-1/2 size-5 stroke-2 fill-none stroke-current">
    <line x1="5" y1="12" x2="19" y2="12" class="translate-x-3 group-hover:translate-x-0 scale-x-0 group-hover:scale-x-100 transition-transform duration-300 ease-in-out" />
    <polyline points="12 5 19 12 12 19" class="-translate-x-1 group-hover:translate-x-0 transition-transform duration-300 ease-in-out" />
  </svg>
</a>

<script>
  function setupTagBadges() {
    document.querySelectorAll('.tag-badge').forEach((badge) => {
      badge.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const url = (e.currentTarget as HTMLElement).dataset.tagUrl;
        if (url) {
          window.location.href = url;
        }
      });
    });
  }

  // Setup on initial load
  setupTagBadges();

  // Setup after view transitions
  document.addEventListener('astro:after-swap', setupTagBadges);
</script>
