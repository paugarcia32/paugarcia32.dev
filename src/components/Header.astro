---
import Container from "@components/Container.astro";
import Icon from "@components/Icon.astro";
import Link from "@components/Link.astro";
import { SITE } from "@consts";
---

<header>
  <Container>
    <div class="flex items-center justify-between">
      <Link href="/" underline={false}>
        <div class="font-semibold">
          {SITE.NAME}
        </div>
      </Link>

      <div class="flex items-center gap-1">
        <!-- Desktop nav links -->
        <nav class="hidden sm:flex items-center gap-1">
          <Link href="/blog">blog</Link>
          <span>{`/`}</span>
          <Link href="/work">work</Link>
          <span>{`/`}</span>
          <Link href="/projects">projects</Link>
          <span class="mx-1">{`/`}</span>
        </nav>

        <!-- Search button (always visible) -->
        <button
          id="search-button"
          aria-label="Search"
          class="flex items-center gap-1.5 rounded-md px-2 py-1 text-sm transition-colors duration-300 hover:bg-cloud-dark/5 dark:hover:bg-ivory-dark/5"
        >
          <Icon name="magnifying-glass" size={16} />
          <span class="hidden sm:inline text-cloud-dark dark:text-cloud-light">âŒ˜K</span>
        </button>

        <!-- Hamburger button (mobile only) -->
        <button
          id="hamburger-button"
          class="sm:hidden flex items-center justify-center rounded-md p-1.5 transition-colors duration-300 hover:bg-cloud-dark/5 dark:hover:bg-ivory-dark/5"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <!-- Hamburger icon -->
          <Icon id="hamburger-icon" name="bars-3" size={16} />
          <!-- Close icon (hidden by default) -->
          <Icon id="close-icon" name="x-mark" size={16} class="hidden" />
        </button>
      </div>
    </div>
  </Container>

  <!-- Mobile menu dropdown -->
  <div
    id="mobile-menu"
    class="hidden border-t border-black/10 dark:border-white/10"
  >
    <Container>
      <nav class="flex flex-col gap-3 py-4">
        <Link href="/blog">blog</Link>
        <Link href="/work">work</Link>
        <Link href="/projects">projects</Link>
      </nav>
    </Container>
  </div>
</header>

<script>
  function init() {
    const searchButton = document.getElementById("search-button");
    const dialog = document.getElementById("command-palette") as HTMLDialogElement;
    const hamburgerButton = document.getElementById("hamburger-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const hamburgerIcon = document.getElementById("hamburger-icon");
    const closeIcon = document.getElementById("close-icon");

    searchButton?.addEventListener("click", () => {
      dialog?.showModal();
      const searchInput = document.getElementById("search-input") as HTMLInputElement;
      searchInput?.focus();
    });

    hamburgerButton?.addEventListener("click", () => {
      const isOpen = !mobileMenu?.classList.contains("hidden");

      if (isOpen) {
        mobileMenu?.classList.add("hidden");
        hamburgerIcon?.classList.remove("hidden");
        closeIcon?.classList.add("hidden");
        hamburgerButton.setAttribute("aria-expanded", "false");
      } else {
        mobileMenu?.classList.remove("hidden");
        hamburgerIcon?.classList.add("hidden");
        closeIcon?.classList.remove("hidden");
        hamburgerButton.setAttribute("aria-expanded", "true");
      }
    });
  }

  function closeMobileMenu() {
    const mobileMenu = document.getElementById("mobile-menu");
    const hamburgerButton = document.getElementById("hamburger-button");
    const hamburgerIcon = document.getElementById("hamburger-icon");
    const closeIcon = document.getElementById("close-icon");

    mobileMenu?.classList.add("hidden");
    hamburgerIcon?.classList.remove("hidden");
    closeIcon?.classList.add("hidden");
    hamburgerButton?.setAttribute("aria-expanded", "false");
  }

  document.addEventListener("DOMContentLoaded", init);
  document.addEventListener("astro:after-swap", () => {
    closeMobileMenu();
    init();
  });
</script>
